<?xml version="1.0"?>
<robot name="justina" xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:property name="base_radius" value="0.2"/>
  <xacro:property name="base_height" value="0.2"/>
  <xacro:property name="base_mass"   value="10.0"/>
  <xacro:property name="wheel_radius" value="0.08"/>
  <xacro:property name="wheel_width"  value="0.03"/>
  <xacro:property name="wheel_mass"   value="0.5"/>
  <xacro:property name="PI" value="3.14159265358979323846"/>
  
  <xacro:include filename="$(find justina_description)/urdf/justina_base_rim.xacro"/>
  
  <link name="base_link"/>
  <link name="base_center">
    <inertial>
      <origin xyz="0 0 0"/>
      <mass value="${base_mass}"/>
      <xacro:cylinder_inertia m="${base_mass}" r="${base_radius}" h="${base_height}"/>
    </inertial>
    <visual>
      <geometry><cylinder radius="${base_radius}" length="${base_height}"/></geometry>
      <material name="base_material"><color rgba="0 0 1 1"/></material>
    </visual>
    <collision>
      <geometry><cylinder radius="${base_radius}" length="${base_height}"/></geometry>
    </collision>
  </link>
  <joint name="base_joint" type="fixed">
    <parent link="base_link" />
    <child link="base_center" />
    <origin xyz="0 0 0.1905"/>
  </joint>
  <gazebo reference="base_center">
    <material>Gazebo/Blue</material>
    <selfCollide>false</selfCollide>
    <gravity>true</gravity>
  </gazebo>

  <!-- LEFT WHEEL ACTUATOR-->
  <link name="left_wheel_link">
    <inertial>
      <origin xyz="0 0 0"/>
      <mass value="${wheel_mass}"/>
      <xacro:cylinder_inertia m="${wheel_mass}" r="${wheel_radius}" h="${wheel_width}"/>
    </inertial>
    <visual>
      <geometry><cylinder radius="${wheel_radius}" length="${wheel_width}"/></geometry>
      <material name="wheel_material"><color rgba="0 0 0 1"/></material>
    </visual>
    <collision>
      <geometry><cylinder radius="${wheel_radius}" length="${wheel_width}"/></geometry>
    </collision>
  </link>
  <joint name="wheel_left_joint" type="continuous">
    <parent link="base_center" />
    <child link="left_wheel_link" />
    <axis xyz="0 0 1"/>
    <origin xyz="${(base_radius+0.03)*cos( PI/3)} ${(base_radius+0.03)*sin( PI/3)} -0.05" rpy="${PI/2} 0 ${ PI/3+PI/2}"/>
    <limit velocity="30.0" effort="0.6"/>
  </joint>
  <transmission name="wheel_left_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_left_joint">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="wheel_left_motor">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <gazebo reference="left_wheel_link">
    <material>Gazebo/Black</material>
    <selfCollide>false</selfCollide>
    <gravity>true</gravity>
    <collision name="left_wheel_link_collision">
      <surface><friction>
        <ode>
          <mu>0.1</mu>
          <mu2>15</mu2>
          <fdir1>0 0 1</fdir1>
        </ode></friction>
      </surface>
    </collision>
  </gazebo>
  
  <!-- RIGHT WHEEL ACTUATOR-->
  <link name="right_wheel_link">
    <inertial>
      <origin xyz="0 0 0"/>
      <mass value="${wheel_mass}"/>
      <xacro:cylinder_inertia m="${wheel_mass}" r="${wheel_radius}" h="${wheel_width}"/>
    </inertial>
    <visual>
      <geometry><cylinder radius="${wheel_radius}" length="${wheel_width}"/></geometry>
      <material name="wheel_material"><color rgba="0 0 0 1"/></material>
    </visual>
    <collision>
      <geometry><cylinder radius="${wheel_radius}" length="${wheel_width}"/></geometry>
    </collision>
  </link>
  <joint name="wheel_right_joint" type="continuous">
    <parent link="base_center" />
    <child link="right_wheel_link" />
    <axis xyz="0 0 1"/>
    <origin xyz="${(base_radius+0.03)*cos(-PI/3)} ${(base_radius+0.03)*sin(-PI/3)} -0.05" rpy="${PI/2} 0 ${-PI/3+PI/2}"/>
    <limit velocity="30.0" effort="0.6"/>
  </joint>
  <transmission name="wheel_right_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_right_joint">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="wheel_right_motor">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <gazebo reference="right_wheel_link">
    <material>Gazebo/Black</material>
    <selfCollide>false</selfCollide>
    <gravity>true</gravity>
    <collision name="right_wheel_link_collision">
      <surface><friction>
        <ode>
          <mu>0.1</mu>
          <mu2>15</mu2>
          <fdir1>0 0 1</fdir1>
        </ode></friction>
      </surface>
    </collision>
  </gazebo>

  <!-- BACK WHEEL ACTUATOR-->
  <link name="back_wheel_link">
    <inertial>
      <origin xyz="0 0 0"/>
      <mass value="${wheel_mass}"/>
      <xacro:cylinder_inertia m="${wheel_mass}" r="${wheel_radius}" h="${wheel_width}"/>
    </inertial>
    <visual>
      <geometry><cylinder radius="${wheel_radius}" length="${wheel_width}"/></geometry>
      <material name="wheel_material"><color rgba="0 0 0 1"/></material>
    </visual>
    <collision>
      <geometry><cylinder radius="${wheel_radius}" length="${wheel_width}"/></geometry>
    </collision>
  </link>
  <joint name="wheel_back_joint" type="continuous">
    <parent link="base_center" />
    <child link="back_wheel_link" />
    <axis xyz="0 0 1"/>
    <origin xyz="${(base_radius+0.03)*cos(PI)} ${(base_radius+0.03)*sin(PI)} -0.05" rpy="${PI/2} 0 ${PI+PI/2}"/>
    <limit velocity="30.0" effort="0.6"/>
  </joint>
  <transmission name="wheel_back_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_back_joint">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="wheel_back_motor">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <gazebo reference="back_wheel_link">
    <material>Gazebo/Black</material>
    <selfCollide>false</selfCollide>
    <gravity>true</gravity>
    <collision name="back_wheel_link_collision">
      <surface><friction>
        <ode>
          <mu>0.1</mu>
          <mu2>15</mu2>
          <fdir1>0 0 1</fdir1>
        </ode></friction>
      </surface>
    </collision>
  </gazebo>
</robot>
